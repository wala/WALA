#!/bin/sh -eux

run_gradle() {
  ./gradlew --continue --no-build-cache --stacktrace "$@"
}

case "$(javac -version 2>&1)" in
  (javac\ 1.8.*)
    # ECJ compilation only needs to run on one operating system; we choose Linux arbitrarily
    if [ "${TRAVIS_OS_NAME:-}" != linux ]; then
      skip_ecj=-PskipJavaUsingEcjTasks
    fi
    run_gradle ${skip_ecj:-} linters javadoc build publishToMavenLocal
    ;;
  (*)
    run_gradle :com.ibm.wala.core:test
    ;;
esac

./check-git-cleanliness.sh
